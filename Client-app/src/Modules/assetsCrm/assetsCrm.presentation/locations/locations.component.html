<main class="table">
  <p-table
    #dt2
    [value]="pagesData.data?.items ?? []"
    dataKey="id"
    [loading]="loading"
    [tableStyle]="{ 'min-width': '20rem' }"
    sortMode="single"
  >
    <ng-template pTemplate="caption">
      <div class="flex items-center justify-between">
        <h1 class="text-3xl font-medium">
          {{ "locations.title" | translate }}
        </h1>
        <div class="flex items-center gap-2">
          <p-inputgroup class="flex relative">
            <!-- <div class="flex items-center"> -->
            <input
              pInputText
              placeholder="{{ 'General.search' | translate }}"
              [(ngModel)]="searchQuery.data"
            />
            <p-button
              icon="pi pi-times"
              severity="secondary"
              variant="text"
              class="absolute pt-3 w-4 ltr:right-12 rtl:left-12 z-10 [&>button]:w-3 [&>button]:h-3"
              (onClick)="table.clearFilter()"
            ></p-button>
            <!-- </div> -->
            <p-inputgroup-addon>
              <p-button
                icon="pi pi-search"
                severity="secondary"
                variant="text"
                (click)="table.onFilter()"
                class="z-10"
              />
            </p-inputgroup-addon>
          </p-inputgroup>
          @if(authService.isEditor()) {
          <p-button
            label="{{ 'Create_update_dialog.new' | translate }}"
            icon="pi pi-plus"
            class="mr-2"
            (onClick)="create()"
          />
          }
        </div>
      </div>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        @for (column of columns(); track $index) {
        <th pSortableColumn="{{ column.field }}">
          {{ column.name }}
        </th>
        }
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item>
      <tr>
        <td>
          {{ item.name.ar }}
        </td>
        <td>
          {{ item.name.en }}
        </td>
        <td>
          <p-badge
            [value]="removeDecimals(item.completionPercentage) + '%'"
            [severity]="stockSeverity(item)"
          />
        </td>
        <td>
          {{ item.assetsValue | currency : " EGP " : "symbol" : "1.0-0" }}
        </td>
        <td>
          {{ item.totalAssetRevenue | currency : " EGP " : "symbol" : "1.0-0" }}
        </td>
        <td>
          {{ item.assetsNumber }}
        </td>
        @if(authService.isEditor()) {
        <td>
          <p-toast />
          <p-button
            icon="pi pi-pencil"
            rounded
            severity="secondary"
            variant="text"
            (onClick)="update(item)"
          />
          <p-button
            icon="pi pi-trash"
            rounded
            severity="danger"
            variant="text"
            (onClick)="delete(item)"
          />
        </td>
        }
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5">No properties found.</td>
      </tr>
    </ng-template>
  </p-table>
  <p-paginator
    (onPageChange)="table.onPageChange($event)"
    [first]="table.pageIndex()"
    [rows]="table.offset()"
    [totalRecords]="pagesData.data?.pageInfo?.totalCount ?? 0"
    [rowsPerPageOptions]="[20, 50, 100]"
  />
  <p-confirmdialog />
</main>
