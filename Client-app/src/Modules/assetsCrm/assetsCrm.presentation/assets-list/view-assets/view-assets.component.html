@if(asset) {
<main
  class="flex max-lg:flex-col gap-4 bg-white rounded-lg p-6 shadow min-h-[88vh]"
>
  <section class="flex flex-col gap-4 flex-1">
    @if(asset.images) {
    <p-galleria
      [value]="images"
      [numVisible]="5"
      [circular]="true"
      [showItemNavigators]="true"
      [showThumbnails]="false"
    >
      <ng-template pTemplate="item" let-item>
        <img [src]="item" class="w-full h-52 object-contain" />
      </ng-template>
    </p-galleria>
    }
    <div class="flex justify-between gap-4">
      <div>
        <h2 class="text-lg font-bold">
          {{ getTranslated(asset.name) }}
        </h2>
        <h3 class="text-[var(--secondary-color)] flex items-center gap-2 mt-2">
          {{ asset.location?.translatedName }}
          @if(asset.pointOnMap?.latitude && asset.pointOnMap?.longitude) {
          <button>
            <img
              src="../../assets/icons/google-map-icon.webp"
              class="w-8 h-8 p-1 bg-white rounded-full shadow"
              alt="google map"
              (click)="showMap = true"
            />
          </button>
          }
        </h3>
      </div>
      <div class="flex gap-4 price">
        <img
          src="../../assets/icons/company-gary.svg"
          class="w-10"
          alt="company"
        />
        <div class="flex flex-col">
          <span class="text-sm text-[var(--secondary-color)]">
            {{ "map.project_name" | translate }}
          </span>
          <span class="font-medium text-lg">
            {{ asset.project?.translatedName }}
          </span>
        </div>
      </div>
    </div>
    <hr />
    <div class="max-lg:hidden">
      <h2 class="text-lg font-bold">
        {{ "AssetsList.property_overview" | translate }}
      </h2>
      <p class="font-medium">
        {{ getTranslated(asset.description) }}
      </p>
    </div>
    <p-accordion [value]="0" class="lg:hidden">
      <p-accordion-panel [value]="1">
        <p-accordion-header class="!px-0">{{
          "AssetsList.property_overview" | translate
        }}</p-accordion-header>

        <p-accordion-content class>
          <p class="font-medium">
            {{ getTranslated(asset.description) }}
          </p>
        </p-accordion-content>
      </p-accordion-panel>
    </p-accordion>
    <hr />
    <div>
      <div class="flex flex-col gap-2">
        <h2 class="text-lg font-bold">
          {{ "AssetsList.add_comment" | translate }}
        </h2>
        <div class="relative">
          <input
            pInputText
            placeholder="{{ 'AssetsList.write_comment' | translate }}"
            [(ngModel)]="comment"
            class="w-full"
            (keydown.enter)="postComment()"
          />
          <p-button
            class="absolute rtl:left-3 ltr:right-3 mt-1 [&>button]:w-8 [&>button]:h-8 [&>button]:rounded-full"
            type="submit"
            [disabled]="!comment || commentLoading"
            (onClick)="postComment()"
            [icon]="commentLoading ? 'pi pi-spin pi-spinner' : 'pi pi-arrow-up'"
          >
          </p-button>
        </div>
      </div>
      <ul class="flex flex-col gap-4 mt-4" id="scrollContainer">
        @for (comment of comments; track $index) {
        <li [id]="comment.commentId">
          <div class="flex gap-2">
            <img
              src="./assets/icons/user.svg"
              class="w-10 h-10 rounded-full"
              alt="user image"
            />
            <div class="flex flex-col">
              <div class="flex items-center gap-2">
                <b>
                  {{ comment.userEmail }}
                </b>
                <span class="text-[var(--secondary-color)] text-sm">{{
                  comment.createAt | date : "mediumDate"
                }}</span>
              </div>
              <p class="font-medium">
                {{ comment.text }}
              </p>
            </div>
          </div>
        </li>
        }
      </ul>
    </div>
  </section>

  <p-divider layout="vertical" class="max-lg:!hidden" />

  <section class="lg:w-1/3 flex flex-col gap-4">
    <h2 class="text-lg font-bold">
      {{ "AssetsList.current_values" | translate }}
    </h2>

    <p class="text-[var(--secondary-color)]">
      {{ "AssetsList.current_values_disc" | translate }}
    </p>

    <!-- Current Value -->
    <div class="flex flex-col gap-4 bg-[#2F2B3D0F] rounded-lg p-6">
      @if(asset.currentValue?.value) {
      <div class="flex justify-between">
        <span class="font-medium">{{
          "AssetsList.current_value" | translate
        }}</span>
        <span class="font-medium text-sm text-[var(--secondary-color)]">
          {{ asset.currentValue?.evaluatedAt | date : "mediumDate" }}</span
        >
      </div>
      <span class="text-4xl font-bold">{{
        asset.currentValue?.value | currency : " EGP " : "symbol" : "1.0-0"
      }}</span>

      @if(asset.currentValue?.reportUrl) {
      <a
        href="{{ imageUrlBase + asset.currentValue?.reportUrl }}"
        target="_blank"
        class="p-button font-bold"
      >
        {{ "map.open_report" | translate }}
        <i class="pi pi-external-link text-base"></i>
      </a>

      } @else {
      <p-button
        disabled="true"
        label="{{ 'map.no_report' | translate }}"
        class="w-full [&>button]:!w-full"
      />
      }} @else {
      <span class="text-xl font-bold">{{
        "AssetsList.No_evaluation_yet" | translate
      }}</span>
      }
    </div>

    <!-- Rental value -->
    <div class="flex flex-col gap-4 bg-[#2F2B3D0F] rounded-lg p-6">
      @if(asset.rentalValue?.value) {
      <div class="flex justify-between">
        <span class="font-medium">{{ "AssetsList.revenue" | translate }}</span>
        <span class="font-medium text-sm text-[var(--secondary-color)]">
          {{ asset.rentalValue?.evaluatedAt | date : "mediumDate" }}</span
        >
      </div>
      <span class="text-4xl font-bold">{{
        asset.rentalValue?.value | currency : " EGP " : "symbol" : "1.0-0"
      }}</span>
      @if(asset.rentalValue?.reportUrl) {
      <a
        href="{{ imageUrlBase + asset.rentalValue?.reportUrl }}"
        target="_blank"
        class="p-button font-bold"
      >
        {{ "map.open_report" | translate }}
        <i class="pi pi-external-link text-base"></i>
      </a>

      } @else {
      <p-button
        disabled="true"
        label="{{ 'map.no_report' | translate }}"
        class="w-full [&>button]:!w-full"
      />
      } } @else {
      <span class="text-xl font-bold">{{
        "AssetsList.No_rental_value" | translate
      }}</span>
      }
    </div>

    <!-- ROI value -->
    <div class="flex flex-col gap-4 bg-[#2F2B3D0F] rounded-lg p-6">
      @if(asset.rentalValue?.value && asset.currentValue?.value) {
      <span class="font-medium">{{ "AssetsList.roi" | translate }}</span>

      <span class="text-4xl font-bold">{{
        (
          (asset.rentalValue?.value! / asset.currentValue?.value!) *
          100
        ).toFixed(2) + "%"
      }}</span>
      } @else {
      <span class="text-xl font-bold">{{
        "AssetsList.no_roi" | translate
      }}</span>
      }
    </div>
    <p-accordion [value]="0" class="rounded-lg">
      <p-accordion-panel [value]="1" class="rounded-lg">
        <p-accordion-header class="!bg-[#2F2B3D0F]">{{
          "AssetsList.previous_values" | translate
        }}</p-accordion-header>
        @for (value of asset.values; track $index) {
        <p-accordion-content class="[&>div]:bg-[#2F2B3D0F]">
          <p class="text-lg font-bold">
            {{ value.value | currency : " EGP " : "symbol" : "1.0-0" }}
          </p>
          <p class="text-[var(--secondary-color)]">
            {{ value.evaluatedAt | date : "mediumDate" }}
          </p>
        </p-accordion-content>
        }
      </p-accordion-panel>
    </p-accordion>
  </section>
  <p-dialog
    [modal]="true"
    [(visible)]="showMap"
    header="{{ 'AssetsList.show_on_map' | translate }}"
  >
    <google-map [options]="options">
      <map-marker [position]="convertPointsToLatLng(asset.pointOnMap)"
    /></google-map>
  </p-dialog>
</main>
}@else {
<div class="flex items-center justify-center h-[88vh]">
  <div class="spinner">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
}
